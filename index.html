<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>batas ¬∑ manusia ‚Äî generator ide video petualangan</title>
    <!-- Plus Jakarta Sans untuk logo dan judul -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <!-- Inter untuk lainnya -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,300..700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Inter", sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 1.8rem;
            color: #333333;
        }

        .container {
            max-width: 1000px;
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        .logo-container {
            text-align: center;
            margin: 0.5rem 0 2.5rem 0;
        }
        .logo-container h1 {
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 2.8rem;
            font-weight: 800;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, #a855f7, #d946ef);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
            text-shadow: 0 0 20px rgba(168, 85, 247, 0.5);
        }
        .logo-container .sub {
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-weight: 400;
            color: #666666;
            font-size: 1rem;
            margin-top: 0.25rem;
            letter-spacing: 0.3px;
            text-shadow: 0 0 10px rgba(168, 85, 247, 0.2);
        }

        .card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(16px) saturate(180%);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            border-radius: 2.5rem;
            padding: 2.2rem 2.2rem;
            box-shadow: 0 25px 50px -12px rgba(168, 85, 247, 0.2), 0 4px 18px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(168, 85, 247, 0.2);
            transition: all 0.2s ease;
        }

        .api-key-container {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            border-radius: 2rem;
            padding: 1rem 1.8rem;
            margin-bottom: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.8rem;
            border: 1px solid rgba(168, 85, 247, 0.3);
            box-shadow: 0 10px 15px -3px rgba(168, 85, 247, 0.1);
        }
        .api-key-label {
            font-weight: 600;
            color: #a855f7;
            min-width: 90px;
            font-size: 0.95rem;
        }
        .api-key-input {
            flex: 1;
            min-width: 220px;
            padding: 0.7rem 1.3rem;
            border-radius: 3rem;
            border: 2px solid #e5e7eb;
            font-family: 'Inter', monospace;
            font-size: 0.9rem;
            background: white;
            color: #333333;
            outline: none;
            transition: 0.15s;
        }
        .api-key-input:focus {
            border-color: #a855f7;
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.2);
        }
        .api-key-hint {
            font-size: 0.8rem;
            color: #666666;
            width: 100%;
            margin-top: 0.2rem;
        }

        .version-container {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            border-radius: 2rem;
            padding: 1rem 1.8rem;
            margin-bottom: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.8rem;
            border: 1px solid rgba(168, 85, 247, 0.3);
            box-shadow: 0 10px 15px -3px rgba(168, 85, 247, 0.1);
        }
        .version-label {
            font-weight: 600;
            color: #a855f7;
            min-width: 90px;
            font-size: 0.95rem;
        }
        .version-select {
            flex: 1;
            min-width: 220px;
            padding: 0.7rem 1.3rem;
            border-radius: 3rem;
            border: 2px solid #e5e7eb;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            background: white;
            color: #333333;
            outline: none;
            transition: 0.15s;
            cursor: pointer;
        }
        .version-select:focus {
            border-color: #a855f7;
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.2);
        }
        .version-description {
            font-size: 0.8rem;
            color: #666666;
            width: 100%;
            margin-top: 0.2rem;
            font-style: italic;
        }

        .button-generate {
            background: linear-gradient(135deg, #a855f7, #d946ef);
            border: none;
            padding: 0.8rem 2.2rem;
            border-radius: 3rem;
            font-weight: 600;
            font-size: 1rem;
            color: white;
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
            cursor: pointer;
            box-shadow: 0 10px 25px -5px rgba(168, 85, 247, 0.3);
            transition: 0.2s;
            letter-spacing: 0.01em;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .button-generate:hover {
            background: linear-gradient(135deg, #9333ea, #c026d3);
            box-shadow: 0 15px 30px -5px rgba(168, 85, 247, 0.4);
            transform: scale(1.02);
        }

        .button-generate:disabled {
            opacity: 0.5;
            pointer-events: none;
            filter: grayscale(0.3);
        }

        .button-secondary {
            background: white;
            border: 1.5px solid #a855f7;
            padding: 0.5rem 1.5rem;
            border-radius: 3rem;
            font-weight: 600;
            font-size: 0.9rem;
            color: #a855f7;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(168, 85, 247, 0.1);
            transition: 0.1s;
        }
        .button-secondary:hover {
            background: #a855f7;
            color: white;
            border-color: #d946ef;
        }

        .idea-grid {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            margin: 1.5rem 0 1.5rem;
        }

        .idea-item {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            border-radius: 2rem;
            padding: 0.9rem 1.5rem;
            border-left: 8px solid #a855f7;
            box-shadow: 0 10px 15px -3px rgba(168, 85, 247, 0.1);
            transition: 0.15s ease;
            cursor: pointer;
            border: 1px solid rgba(168, 85, 247, 0.2);
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .idea-item:hover {
            background: white;
            border-left-width: 12px;
            border-left-color: #d946ef;
            box-shadow: 0 15px 20px -5px rgba(168, 85, 247, 0.2);
        }

        .idea-item.selected {
            background: white;
            border-left-color: #d946ef;
            border: 2px solid #a855f7;
            box-shadow: 0 8px 25px rgba(168, 85, 247, 0.2);
        }

        .idea-number {
            width: 2.3rem;
            height: 2.3rem;
            background: linear-gradient(135deg, #a855f7, #d946ef);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            flex-shrink: 0;
            font-size: 0.9rem;
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.3);
        }

        .idea-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: #333333;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        .script-output {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(16px);
            border-radius: 2.5rem;
            padding: 1.8rem;
            border: 1px solid rgba(168, 85, 247, 0.2);
            box-shadow: 0 20px 40px -15px rgba(168, 85, 247, 0.15);
            margin-top: 2rem;
        }

        .script-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #a855f7;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .script-text {
            font-size: 1.1rem;
            line-height: 1.6;
            white-space: pre-wrap;
            color: #333333;
            font-weight: 400;
            border-left: 4px solid #a855f7;
            padding-left: 1.3rem;
        }

        .scene-prompt {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(8px);
            border-radius: 2rem;
            padding: 1.3rem;
            margin: 1.5rem 0 0.5rem;
            border: 1px dashed #a855f7;
        }

        .scene-title {
            font-weight: 700;
            color: #a855f7;
            margin-bottom: 0.8rem;
            font-size: 1.2rem;
        }

        .prompt-container {
            background: white;
            border-radius: 1.3rem;
            padding: 0.9rem 1.2rem;
            margin-bottom: 0.8rem;
            border: 1px solid rgba(168, 85, 247, 0.2);
        }

        .prompt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .badge {
            background: linear-gradient(135deg, #a855f7, #d946ef);
            border-radius: 3rem;
            padding: 0.2rem 1rem;
            font-size: 0.7rem;
            font-weight: 600;
            color: white;
            display: inline-block;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 10px rgba(168, 85, 247, 0.2);
        }

        .copy-btn {
            background: none;
            border: 1px solid #a855f7;
            color: #a855f7;
            padding: 0.2rem 1rem;
            border-radius: 2rem;
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.1s;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }

        .copy-btn:hover {
            background: #a855f7;
            color: white;
        }

        .copy-btn.copied {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }

        .prompt-text {
            font-size: 0.9rem;
            color: #333333;
            line-height: 1.5;
            word-break: break-word;
        }

        .prompt-full {
            display: none;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px dashed #a855f7;
        }

        .show-more {
            color: #a855f7;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: underline;
            margin-top: 0.25rem;
            display: inline-block;
        }

        hr {
            border: 0.5px solid rgba(168, 85, 247, 0.2);
            margin: 1.2rem 0;
        }

        .action-bottom {
            display: flex;
            justify-content: center;
            margin: 1rem 0 0.2rem;
        }

        .selected-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: white;
            border-radius: 4rem;
            padding: 0.5rem 1.5rem;
            margin: 1rem 0 0.5rem;
            border: 1px solid #a855f7;
            box-shadow: 0 4px 15px rgba(168, 85, 247, 0.1);
        }

        #selectedDisplay {
            color: #a855f7;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .footer-credit {
            text-align: center;
            color: #a855f7;
            margin-top: 2rem;
            font-size: 0.8rem;
        }

        .error-message {
            background: #fee2e2;
            color: #b91c1c;
            padding: 0.8rem 1.5rem;
            border-radius: 3rem;
            margin: 1rem 0;
            border: 1px solid #ef4444;
            font-weight: 500;
            font-size: 0.9rem;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .raw-response {
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: monospace;
            font-size: 0.8rem;
            padding: 1rem;
            border-radius: 1rem;
            margin-top: 1rem;
            white-space: pre-wrap;
            max-height: 300px;
            overflow: auto;
        }

        .get-key-link {
            color: #a855f7;
            font-weight: 600;
            text-decoration: none;
            border-bottom: 1px dashed #a855f7;
        }
        .get-key-link:hover {
            color: #d946ef;
        }

        .audio-player-container {
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 2rem;
            border: 1px solid rgba(168, 85, 247, 0.3);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .audio-player-container audio {
            width: 100%;
            height: 40px;
            border-radius: 2rem;
        }

        .audio-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #a855f7;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .voice-badge {
            background: rgba(168, 85, 247, 0.15);
            border: 1px solid #a855f7;
            color: #a855f7;
            padding: 0.2rem 0.8rem;
            border-radius: 2rem;
            font-size: 0.7rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            margin-left: 0.5rem;
        }

        .loading-audio {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #a855f7;
            font-size: 0.9rem;
            padding: 0.5rem;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(168, 85, 247, 0.3);
            border-top-color: #a855f7;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .version-badge {
            display: inline-block;
            background: linear-gradient(135deg, #a855f7, #d946ef);
            color: white;
            padding: 0.2rem 1rem;
            border-radius: 2rem;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        
        .petualangan-container {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            border-radius: 2rem;
            padding: 1rem 1.8rem;
            margin-bottom: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.8rem;
            border: 1px solid rgba(168, 85, 247, 0.3);
            box-shadow: 0 10px 15px -3px rgba(168, 85, 247, 0.1);
        }
        .petualangan-label {
            font-weight: 600;
            color: #a855f7;
            min-width: 120px;
            font-size: 0.95rem;
        }
        .petualangan-select {
            flex: 1;
            min-width: 220px;
            padding: 0.7rem 1.3rem;
            border-radius: 3rem;
            border: 2px solid #e5e7eb;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            background: white;
            color: #333333;
            outline: none;
            transition: 0.15s;
            cursor: pointer;
        }
        .petualangan-select:focus {
            border-color: #a855f7;
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.2);
        }
        .petualangan-description {
            font-size: 0.8rem;
            color: #666666;
            width: 100%;
            margin-top: 0.2rem;
            font-style: italic;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="logo-container">
        <h1>batas ¬∑ manusia</h1>
        <div class="sub">kegagalan biologis dalam petualangan epik</div>
    </div>

    <div class="card">
        <div class="api-key-container">
            <span class="api-key-label">üîë Groq Key</span>
            <input type="password" id="apiKeyInput" class="api-key-input" placeholder="gsk_...">
            <div class="api-key-hint">
                <a href="https://console.groq.com/keys" target="_blank" class="get-key-link">Dapatkan key</a>
            </div>
        </div>

        <div class="api-key-container">
            <span class="api-key-label">üé§ ElevenLabs Key</span>
            <input type="password" id="elevenLabsKeyInput" class="api-key-input" placeholder="elevenlabs_...">
            <div class="api-key-hint">
                <a href="https://elevenlabs.io/app/settings/api-keys" target="_blank" class="get-key-link">Dapatkan key</a> (opsional)
                <span class="voice-badge">‚ú® Rachel</span>
            </div>
        </div>

        <!-- VERSION SELECTOR -->
        <div class="version-container">
            <span class="version-label">üé≠ Versi Ide</span>
            <select id="versionSelect" class="version-select">
                <option value="1">üåø Versi 1: Relatable (realistis)</option>
                <option value="2">üî• Versi 2: Ekstrem (dramatis)</option>
                <option value="3">üåÄ Versi 3: Surreal (absurd)</option>
                <option value="4">üé≠ Versi 4: Filosofis absurd</option>
                <option value="5">üé™ Versi 5: Random murni</option>
                <option value="6">üß™ Versi 6: Aktivitas aneh</option>
                <option value="7">üìä Versi 7: Ilmiah palsu</option>
                <option value="8">üé† Versi 8: Keseharian absurd</option>
                <option value="9">ü™Ñ Versi 9: Fantasi</option>
                <option value="10">üåå Versi 10: Digital</option>
                <option value="11" selected>üè¥‚Äç‚ò†Ô∏è Versi 11: PETUALANGAN (bajak laut, ksatria, dll)</option>
            </select>
            <div class="version-description" id="versionDescription">
                üè¥‚Äç‚ò†Ô∏è PETUALANGAN EPIK - bajak laut, ksatria, penjelajah, luar angkasa, dll
            </div>
        </div>

        <!-- PETUALANGAN THEME SELECTOR (hanya muncul jika versi 11 dipilih) -->
        <div id="petualanganContainer" class="petualangan-container">
            <span class="petualangan-label">üè¥‚Äç‚ò†Ô∏è Tema Petualangan</span>
            <select id="petualanganSelect" class="petualangan-select">
                <option value="bajaklaut">üè¥‚Äç‚ò†Ô∏è Bajak Laut - harta karun, kapal, lautan</option>
                <option value="ksatria">‚öîÔ∏è Ksatria - kastil, naga, pedang</option>
                <option value="samurai">üó°Ô∏è Samurai - Jepang kuno, bushido</option>
                <option value="penjelajah">üå≤ Penjelajah - hutan belantara, gunung, sungai</option>
                <option value="astronot">üöÄ Astronot - luar angkasa, planet asing</option>
                <option value="atlantis">üåä Atlantis - kota bawah laut, mitologi</option>
                <option value="mesir">üî∫ Mesir Kuno - piramida, mumi, firaun</option>
                <option value="viking">üõ∂ Viking - kapal panjang, mitologi nordik</option>
                <option value="cowboy">ü§† Koboi - barat liar, petualangan padang pasir</option>
                <option value="dunia lain">üåÄ Isekai - masuk ke dunia game/fantasi</option>
            </select>
            <div class="petualangan-description">
                Pilih tema petualangan untuk karakter skeleton
            </div>
        </div>

        <div id="ideaList" class="idea-grid">
            <div style="text-align: center; color: #666666; padding: 1.5rem; font-style: italic; font-size: 0.95rem;">
                Masukkan API Key, pilih versi, lalu generate
            </div>
        </div>

        <div id="selectedArea" style="display: none;">
            <div class="selected-bar">
                <span id="selectedDisplay">‚úî ide terpilih: </span>
                <button id="generateScriptBtn" class="button-secondary">üé¨ buat naskah petualangan</button>
            </div>
        </div>

        <div class="action-bottom">
            <button id="generateIdeasBtn" class="button-generate">
                <span>‚ú®</span> generate 5 ide fresh
            </button>
        </div>
    </div>

    <div id="scriptContainer" class="script-output" style="display: none;">
        <div class="script-label">naskah petualangan (bahasa indonesia) ¬∑ 2 kalimat per scene</div>
        <div id="scriptText" class="script-text"></div>
        
        <div id="audioContainer" style="display: none;" class="audio-player-container">
            <div class="audio-label">
                <span>üéµ Suara Rachel</span>
            </div>
            <audio id="audioPlayer" controls preload="metadata">
                <source src="" type="audio/mpeg">
                Browser tidak mendukung audio player.
            </audio>
            <div id="audioLoading" class="loading-audio" style="display: none;">
                <div class="spinner"></div>
                <span>Menghasilkan suara...</span>
            </div>
        </div>

        <hr>
        <div class="script-label">image prompts (english ‚Äî format rumus)</div>
        <div id="scenePrompts"></div>
        <div id="debugResponse" style="display: none;" class="raw-response"></div>
    </div>

    <div class="footer-credit">
        [Subjek] + [Aksi Dinamis] + [Lingkungan Petualangan] + [Cahaya Epik] + [Sudut Kamera Aksi] + [VFX] + Render 3D
    </div>
</div>

<script>
    const GROQ_URL = "https://api.groq.com/openai/v1/chat/completions";
    const GROQ_MODEL = "llama-3.3-70b-versatile";
    const ELEVENLABS_URL = "https://api.elevenlabs.io/v1";
    const RACHEL_VOICE_ID = "21m00Tcm4TlvDq8ikWAM";
    
    const STORAGE_KEYS = {
        GROQ_API_KEY: 'batasManusia_groqKey',
        ELEVENLABS_API_KEY: 'batasManusia_elevenLabsKey'
    };
    
    let generatedIdeas = [];
    let selectedIdeaIndex = null;

    const generateIdeasBtn = document.getElementById('generateIdeasBtn');
    const ideaListDiv = document.getElementById('ideaList');
    const selectedArea = document.getElementById('selectedArea');
    const selectedDisplay = document.getElementById('selectedDisplay');
    const generateScriptBtn = document.getElementById('generateScriptBtn');
    const scriptContainer = document.getElementById('scriptContainer');
    const scriptTextDiv = document.getElementById('scriptText');
    const scenePromptsDiv = document.getElementById('scenePrompts');
    const apiKeyInput = document.getElementById('apiKeyInput');
    const elevenLabsKeyInput = document.getElementById('elevenLabsKeyInput');
    const debugResponse = document.getElementById('debugResponse');
    const versionSelect = document.getElementById('versionSelect');
    const versionDescription = document.getElementById('versionDescription');
    const petualanganContainer = document.getElementById('petualanganContainer');
    const petualanganSelect = document.getElementById('petualanganSelect');
    
    const audioContainer = document.getElementById('audioContainer');
    const audioPlayer = document.getElementById('audioPlayer');
    const audioLoading = document.getElementById('audioLoading');

    // Show/hide petualangan selector based on version
    versionSelect.addEventListener('change', function() {
        const descriptions = {
            '1': 'üåø Aktivitas sehari-hari yang realistis (begadang, main game, kopi)',
            '2': 'üî• Versi paling dramatis dan ekstrem (meledak, hancur, menjerit)',
            '3': 'üåÄ Aktivitas surreal dan tidak masuk akal (menatap kulkas kosong, ngomong sama tembok)',
            '4': 'üé≠ Filosofis absurd (mencari arti hidup, overthinking, nahan uang)',
            '5': 'üé™ Kombinasi paling random dan tidak terduga',
            '6': 'üß™ Aktivitas aneh yang jarang terpikirkan (ngupas bawang, main petak umpet)',
            '7': 'üìä Gaya ilmiah palsu dengan satuan absurd (milidetik, desibel, volt)',
            '8': 'üé† Aktivitas keseharian yang dibikin absurd (nyari remote, bilang "bentar")',
            '9': 'ü™Ñ Dunia fantasi dan imajinasi (terbang di mimpi, ramuan cinta)',
            '10': 'üåå Tema digital dan teknologi (loading screen, update status, QR code)',
            '11': 'üè¥‚Äç‚ò†Ô∏è PETUALANGAN EPIK - bajak laut, ksatria, penjelajah, luar angkasa, dll'
        };
        versionDescription.textContent = descriptions[versionSelect.value];
        
        // Show petualangan selector only for version 11
        if (versionSelect.value === '11') {
            petualanganContainer.style.display = 'flex';
        } else {
            petualanganContainer.style.display = 'none';
        }
    });

    function loadSavedKeys() {
        const savedGroqKey = localStorage.getItem(STORAGE_KEYS.GROQ_API_KEY);
        if (savedGroqKey) apiKeyInput.value = savedGroqKey;
        
        const savedElevenLabsKey = localStorage.getItem(STORAGE_KEYS.ELEVENLABS_API_KEY);
        if (savedElevenLabsKey) elevenLabsKeyInput.value = savedElevenLabsKey;
    }

    function saveApiKey(key, value) {
        if (value) localStorage.setItem(key, value);
        else localStorage.removeItem(key);
    }

    function getApiKey() { return apiKeyInput.value.trim(); }
    function getElevenLabsKey() { return elevenLabsKeyInput.value.trim(); }
    function isValidApiKey(key) { return key.startsWith('gsk_') && key.length > 20; }

    apiKeyInput.addEventListener('input', () => saveApiKey(STORAGE_KEYS.GROQ_API_KEY, getApiKey()));
    elevenLabsKeyInput.addEventListener('input', () => saveApiKey(STORAGE_KEYS.ELEVENLABS_API_KEY, getElevenLabsKey()));

    async function generateAudioFile(text) {
        const apiKey = getElevenLabsKey();
        if (!apiKey) { 
            audioContainer.style.display = 'none'; 
            return null; 
        }

        try {
            audioLoading.style.display = 'flex';
            audioContainer.style.display = 'block';
            audioPlayer.src = '';
            
            const response = await fetch(`${ELEVENLABS_URL}/text-to-speech/${RACHEL_VOICE_ID}`, {
                method: 'POST',
                headers: {
                    'xi-api-key': apiKey,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    text: text,
                    model_id: 'eleven_multilingual_v2',
                    voice_settings: { stability: 0.75, similarity_boost: 0.75, style: 0.0, speed: 1.0, use_speaker_boost: true }
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.detail?.message || `ElevenLabs API error: ${response.status}`);
            }

            const audioBlob = await response.blob();
            const audioUrl = URL.createObjectURL(audioBlob);
            audioPlayer.src = audioUrl;
            audioPlayer.load();
            audioLoading.style.display = 'none';
            return audioUrl;
            
        } catch (error) {
            console.error('TTS error:', error);
            audioLoading.style.display = 'none';
            audioContainer.style.display = 'none';
            throw new Error(`Gagal generate suara: ${error.message}`);
        }
    }

    generateIdeasBtn.addEventListener('click', async () => {
        const apiKey = getApiKey();
        
        if (!apiKey) {
            ideaListDiv.innerHTML = `<div class="error-message">‚ùå Masukkan API Key</div>`;
            return;
        }
        
        if (!isValidApiKey(apiKey)) {
            ideaListDiv.innerHTML = `<div class="error-message">‚ùå Format key harus "gsk_" + minimal 20 karakter</div>`;
            return;
        }

        generateIdeasBtn.disabled = true;
        generateIdeasBtn.innerHTML = '‚è≥ memproses...';
        ideaListDiv.innerHTML = `<div style="padding: 1.5rem; color:#666666; text-align:center;">‚è≥ mencari 5 ide fresh versi ${versionSelect.value}...</div>`;

        try {
            const ideas = await callGroqForIdeas(apiKey, versionSelect.value);
            
            if (!ideas || ideas.length === 0) {
                throw new Error('Tidak ada ide yang dihasilkan dari API');
            }
            
            generatedIdeas = ideas;
            renderIdeaList(ideas);
            selectedArea.style.display = 'none';
            scriptContainer.style.display = 'none';
            selectedIdeaIndex = null;
            
        } catch (e) {
            console.error('Error details:', e);
            
            let errorMessage = e.message;
            if (e.message.includes('401')) {
                errorMessage = 'API Key tidak valid atau telah expired. Dapatkan key baru di https://console.groq.com/keys';
            } else if (e.message.includes('429')) {
                errorMessage = 'Terlalu banyak request. Tunggu beberapa saat lalu coba lagi.';
            } else if (e.message.includes('500')) {
                errorMessage = 'Server Groq error. Coba lagi nanti.';
            }
            
            ideaListDiv.innerHTML = `<div class="error-message">‚ùå ${errorMessage}</div>`;
            
            // Tampilkan raw response jika ada
            if (e.rawResponse) {
                debugResponse.textContent = 'Raw Response:\n' + e.rawResponse;
                debugResponse.style.display = 'block';
            }
        } finally {
            generateIdeasBtn.disabled = false;
            generateIdeasBtn.innerHTML = '‚ú® generate 5 ide fresh';
        }
    });

    function selectIdea(index) {
        selectedIdeaIndex = index;
        const items = document.querySelectorAll('.idea-item');
        items.forEach((item, i) => {
            if (i === index) item.classList.add('selected');
            else item.classList.remove('selected');
        });
        selectedDisplay.innerText = `‚úî ide terpilih: ${generatedIdeas[index]}`;
        selectedArea.style.display = 'block';
        scriptContainer.style.display = 'none';
    }

    function renderIdeaList(ideas) {
        if (!ideas || ideas.length === 0) {
            ideaListDiv.innerHTML = `<div class="error-message">Tidak ada ide yang tersedia</div>`;
            return;
        }
        let html = '';
        ideas.forEach((idea, idx) => {
            html += `
                <div class="idea-item" data-index="${idx}">
                    <div class="idea-number">${idx+1}</div>
                    <div class="idea-content">
                        <div class="idea-title">${idea}</div>
                    </div>
                </div>
            `;
        });
        ideaListDiv.innerHTML = html;
        document.querySelectorAll('.idea-item').forEach((el) => {
            el.addEventListener('click', (e) => {
                const index = parseInt(el.dataset.index, 10);
                selectIdea(index);
            });
        });
    }

    async function copyText(button, text) {
        try {
            await navigator.clipboard.writeText(text);
            button.classList.add('copied');
            button.innerHTML = '‚úì copied';
            setTimeout(() => {
                button.classList.remove('copied');
                button.innerHTML = 'üìã copy';
            }, 2000);
        } catch (err) {
            alert('Gagal menyalin teks');
        }
    }

    function toggleFullPrompt(showMoreEl) {
        const fullDiv = showMoreEl.parentElement.querySelector('.prompt-full');
        if (fullDiv.style.display === 'none' || !fullDiv.style.display) {
            fullDiv.style.display = 'block';
            showMoreEl.textContent = 'sembunyikan';
        } else {
            fullDiv.style.display = 'none';
            showMoreEl.textContent = 'lihat selengkapnya';
        }
    }

    function detectFramingType(text) {
        const t = text.toLowerCase();
        
        if (t.includes("close-up") || t.includes("closeup")) return "closeup";
        if (t.includes("medium shot")) return "medium";
        if (t.includes("wide shot")) return "wide";
        if (t.includes("aerial") || t.includes("bird")) return "aerial";
        if (t.includes("low-angle")) return "low-angle";
        if (t.includes("high-angle")) return "high-angle";
        return "dynamic";
    }

    generateScriptBtn.addEventListener('click', async () => {
        if (selectedIdeaIndex === null || !generatedIdeas[selectedIdeaIndex]) {
            alert('Pilih ide terlebih dahulu');
            return;
        }

        const apiKey = getApiKey();
        if (!apiKey || !isValidApiKey(apiKey)) {
            alert('API Key tidak valid');
            return;
        }

        const selectedIdea = generatedIdeas[selectedIdeaIndex];
        const petualanganTheme = petualanganSelect ? petualanganSelect.value : 'bajaklaut';
        
        generateScriptBtn.disabled = true;
        generateScriptBtn.innerHTML = '‚è≥ menyusun naskah petualangan...';
        scriptContainer.style.display = 'block';
        scriptTextDiv.innerText = 'Menunggu response dari Groq...';
        scenePromptsDiv.innerHTML = '';
        debugResponse.style.display = 'none';
        audioContainer.style.display = 'none';

        try {
            const result = await callGroqForScript(apiKey, selectedIdea, versionSelect.value, petualanganTheme);
            
            if (!result.script || !result.scenes || result.scenes.length === 0) {
                throw new Error('Response tidak mengandung script atau scene yang valid');
            }
            
            scriptTextDiv.innerText = result.script;

            // Generate audio jika ada key ElevenLabs
            if (getElevenLabsKey()) {
                try {
                    await generateAudioFile(result.script);
                } catch (audioError) {
                    console.warn('Audio generation failed:', audioError);
                    // Tetap lanjutkan tanpa audio
                }
            }

            let scenesHtml = '';
            result.scenes.forEach((scene, idx) => {
                const framingType = detectFramingType(scene.imagePrompt);
                
                scenesHtml += `
                    <div class="scene-prompt">
                        <div class="scene-title">‚è±Ô∏è ${scene.time || `Scene ${idx+1}`} ¬∑ ${framingType}</div>
                        
                        <div class="prompt-container">
                            <div class="prompt-header">
                                <span class="badge">üñºÔ∏è IMAGE PROMPT</span>
                                <button class="copy-btn" onclick="copyText(this, \`${scene.imagePrompt.replace(/`/g, '\\`')}\`)">üìã copy</button>
                            </div>
                            <div class="prompt-text">${scene.imagePrompt.substring(0, 200)}...</div>
                            <div class="prompt-full">${scene.imagePrompt}</div>
                            <span class="show-more" onclick="toggleFullPrompt(this)">lihat selengkapnya</span>
                        </div>

                        <div class="prompt-container">
                            <div class="prompt-header">
                                <span class="badge">üé• VIDEO PROMPT</span>
                                <button class="copy-btn" onclick="copyText(this, \`${scene.videoPrompt.replace(/`/g, '\\`')}\`)">üìã copy</button>
                            </div>
                            <div class="prompt-text">${scene.videoPrompt.substring(0, 150)}...</div>
                            <div class="prompt-full">${scene.videoPrompt}</div>
                            <span class="show-more" onclick="toggleFullPrompt(this)">lihat selengkapnya</span>
                        </div>
                    </div>
                `;
            });
            scenePromptsDiv.innerHTML = scenesHtml;
            
        } catch (e) {
            console.error('Error:', e);
            
            let errorMessage = e.message;
            if (e.message.includes('401')) {
                errorMessage = 'API Key tidak valid atau telah expired. Dapatkan key baru di https://console.groq.com/keys';
            } else if (e.message.includes('429')) {
                errorMessage = 'Terlalu banyak request. Tunggu beberapa saat lalu coba lagi.';
            } else if (e.message.includes('500')) {
                errorMessage = 'Server Groq error. Coba lagi nanti.';
            }
            
            scriptTextDiv.innerText = '‚ùå GAGAL: ' + errorMessage;
            
            // Tampilkan debug response jika ada
            if (e.rawResponse) {
                debugResponse.textContent = 'Raw Response:\n' + e.rawResponse;
                debugResponse.style.display = 'block';
            }
        } finally {
            generateScriptBtn.disabled = false;
            generateScriptBtn.innerHTML = 'üé¨ buat naskah petualangan';
        }
    });

    loadSavedKeys();

    async function callGroqForIdeas(apiKey, version) {
    // Daftar panjang aktivitas random biar AI ga bosen
    const randomActivities = [
        // Aktivitas random sehari-hari (tidak terduga)
        "Makan Indomie pakai nasi", "Nahan pup di jalan tol", "Nungguin chat dibales", 
        "Nonton tutorial YouTube ga dipraktekin", "Baca komik sambil nyebur di kolam", 
        "Main kelereng di tanah lapang", "Ngejar setan di kuburan", "Nahan kentut di lift",
        "Naik odong-odong keliling kampung", "Main petak umpet sendirian", "Ngomong sama kucing",
        "Nahan ketawa pas lagi sedih", "Minum kopi terus tidur", "Makan permen kadaluarsa",
        "Ngepel lantai sambil nangis", "Nungguin panci mendidih", "Nahan pipis pas lagi asyik main game",
        "Makan sambil rebahan", "Ngerjain skripsi bab 1", "Nahan males buat mandi",
        "Main game terus skip makan", "Nonton film horor sambil makan mie", "Ngecas HP pake powerbank temen",
        
        // Aktivitas absurd
        "Ngomong sama tembok", "Nanya ke bantal", "Main catur sama ayam", 
        "Ngejar layangan putus", "Manjat pohon jambu tetangga", "Ngelembur ga dibayar",
        "Nahan marah sama bos", "Nunggu gajian", "Nahan ngantuk pas meeting zoom",
        "Makan bakso pake sambel 20 sendok", "Minum es teh manis 2 liter", "Tidur setelah sahur",
        
        // Aktivitas petualangan (untuk versi 11)
        "Bertarung dengan naga", "Menyelamatkan putri dari kastil", "Mencari harta karun di pulau terpencil",
        "Melawan bajak laut di laut lepas", "Menjelajah piramida mesir", "Terbang dengan griffin",
        "Berduel dengan ksatria hitam", "Melarikan diri dari penjara bawah tanah", "Mendaki gunung berapi aktif",
        "Menyelam ke kota atlantis", "Bertahan hidup di planet asing", "Melawan pasukan zombi"
    ];
    
    // Daftar organ random
    const randomOrgans = [
        "Tulang ekor", "Jari kelingking", "Pita suara", "Gendang telinga", "Bulu mata",
        "Alis mata", "Lubang hidung", "Ujung siku", "Tempurung lutut", "Tulang rusuk",
        "Urat leher", "Batang otak", "Usus buntu", "Lambung", "Pankreas", "Limpa",
        "Kuku jari", "Tumit", "Pergelangan tangan", "Dagu", "Pipi", "Lidah", "Gusi"
    ];
    
    // Daftar kata kerja random
    const randomVerbs = [
        "Kedutan", "Kesemutan", "Kaku", "Linu", "Berdenging", "Berdenyut", "Mengkerut",
        "Membengkak", "Memar", "Berdenyut", "Melepuh", "Mengelupas", "Bergetar", "Bergemuruh",
        "Ngelu", "Mual", "Pusing", "Semutan", "Kram", "Tegang", "Lemas", "Baal", "Panas",
        "Dingin", "Gatal", "Perih", "Nyeri", "Sakit", "Cekot-cekot"
    ];

    // Base prompt yang sangat bebas
    const basePrompt = `Buat 5 judul video pendek tentang batas tubuh manusia yang **SANGAT UNIK** dan **TIDAK BIASA**.

**WAJIB: 5 ide HARUS BERBEDA TOTAL. JANGAN ADA YANG MIRIP!**

Gunakan 3 FORMAT ini secara ACAK:
1. "Berapa [SATUAN WAKTU] [AKTIVITAS] Sampai [ORGAN] [KATA KERJA]?"
2. "Berapa Lama Kamu Bisa ___ ?"
3. "Apa Yang Terjadi Jika Kamu ___ ?"

**PILIH AKTIVITAS DARI LIST INI (boleh pilih sendiri juga):**
${randomActivities.slice(0, 15).map(a => `- ${a}`).join('\n')}

**PILIH ORGAN DARI LIST INI:**
${randomOrgans.slice(0, 10).map(o => `- ${o}`).join('\n')}

**PILIH KATA KERJA DARI LIST INI:**
${randomVerbs.slice(0, 10).map(v => `- ${v}`).join('\n')}

**CONTOH IDE YANG BAGUS (hanya contoh, JANGAN TIRU PERSIS):**
- Berapa Jam Nonton Drakor Marathon Sampai Tulang Ekormu Linu?
- Berapa Lama Kamu Bisa Nahan Ketawa Pas Lagi Sedih?
- Apa Yang Terjadi Jika Kamu Makan Indomie Pakai Nasi Setiap Hari?
- Berapa Menit Nungguin Chat Dibalas Sampai Jari Jemarimu Kaku?
- Berapa Hari Main Petak Umpet Sendirian Sampai Pita Suaramu Bergetar?

**Tulis 5 ide dengan nomor 1-5.**
**Hanya judul, tanpa penjelasan.**
**INGAT: 5 IDE HARUS BERBEDA SEMUA, JANGAN ADA YANG MIRIP!**
**JANGAN PAKAI JUDUL YANG ITU-ITU AJA (main game, begadang, tahan napas, dll)**`;

    // Untuk versi petualangan, kasih tambahan
    const petualanganPrompt = version === '11' ? `

**VERSI PETUALANGAN EPIK:**
TEMA: ${petualanganSelect.options[petualanganSelect.selectedIndex]?.text || 'Bajak Laut'}

Aktivitas petualangan WAJIB dipilih dari:
- Bertarung dengan naga, Menyelamatkan putri, Mencari harta karun, Melawan bajak laut, Menjelajah piramida, Terbang dengan griffin, Berduel dengan ksatria hitam, Melarikan diri dari penjara, Mendaki gunung berapi, Menyelam ke atlantis, Bertahan di planet asing, Melawan pasukan zombi

CONTOH IDE PETUALANGAN:
- Berapa Jam Bertarung Sampai Tulang Rusukmu Retak?
- Berapa Lama Kamu Bisa Bertahan di Pulau Terkutuk?
- Apa Yang Terjadi Jika Kamu Melawan Naga Api Raksasa?
` : '';

    const fullPrompt = basePrompt + petualanganPrompt;

    const body = {
        model: GROQ_MODEL,
        messages: [{ role: "user", content: fullPrompt }],
        temperature: 1.3, // Naikkin biar lebih liar
        top_p: 0.95,
        max_tokens: 1500
    };

    const resp = await fetch(GROQ_URL, {
        method: 'POST',
        headers: { 'Authorization': `Bearer ${apiKey}`, 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
    });

    if (!resp.ok) {
        const errData = await resp.json().catch(() => ({}));
        throw new Error(errData.error?.message || `HTTP Error ${resp.status}`);
    }

    const data = await resp.json();
    const content = data.choices[0]?.message?.content || "";
    
    const lines = content.split('\n').filter(l => l.trim().match(/^\d+\./));
    const ideas = [];
    
    for (let line of lines) {
        const withoutNumber = line.replace(/^\d+\.\s*/, '').trim();
        
        // Filter kasar buat hindari duplikat
        const isTooSimilar = ideas.some(existing => {
            const existingWords = existing.split(' ').slice(0, 4).join(' ');
            const newWords = withoutNumber.split(' ').slice(0, 4).join(' ');
            return existingWords === newWords;
        });
        
        if (withoutNumber && !isTooSimilar && !withoutNumber.includes('Begadang') && !withoutNumber.includes('Main Game') && !withoutNumber.includes('Tahan Napas')) {
            ideas.push(withoutNumber);
        }
    }
    
    // Kalau kurang dari 5, kasih error
    if (ideas.length < 5) {
        const error = new Error('Gagal menghasilkan 5 ide unik. Coba lagi.');
        error.rawResponse = content;
        throw error;
    }
    
    // Acak urutan sebelum dikembalikan
    return shuffleArray(ideas).slice(0, 5);
}

// Fungsi untuk mengacak array
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

    async function callGroqForScript(apiKey, ideaTitle, version, petualanganTheme = 'bajaklaut') {
        const themeSettings = {
            'bajaklaut': {
                environment: 'kapal bajak laut di tengah lautan, pulau harta karun, gua bawah laut dengan kelelawar, dek kapal dalam badai',
                props: 'pedang, pistol kuno, kompas emas, peta harta karun yang robek, peti emas, tengkorak, botol rum, jangkar berkarat',
                lighting: 'cahaya matahari terbenam kemerahan di laut, cahaya obor yang berkedip di dalam gua, kilatan petir saat badai, cahaya bulan purnama',
                enemies: 'kraken raksasa, bajak laut lawan, monster laut bersisik, hiu lapar'
            },
            'samurai': {
                environment: 'Jepang era Edo, kuil kuno di atas gunung, hutan bambu berkabut, medan perang dengan bendera usang, kastil tradisional',
                props: 'katana dengan ukiran naga, wakizashi, baju samurai dari anyaman bambu, topeng oni, shuriken beracun, lampion kertas',
                lighting: 'cahaya matahari terbit di balik gunung Fuji, senja merah darah, cahaya lentera kertas yang hangat, kabut pagi yang dingin',
                enemies: 'ronin pengembara, ninja bayangan, oni (iblis) bertanduk, shogun tiran'
            }
        };

        const theme = themeSettings[petualanganTheme] || themeSettings['bajaklaut'];

        const systemPrompt = `You are a video scriptwriter for a viral YouTube Shorts channel with PETUALANGAN EPIK theme.

TEMA PETUALANGAN: ${petualanganTheme}
LINGKUNGAN: ${theme.environment}
PROPERTI: ${theme.props}
PENCAHAYAAN: ${theme.lighting}
MUSUH: ${theme.enemies}

Write a script in INDONESIAN language based on this title: "${ideaTitle}"

**PENTING: SETIAP SCENE HANYA 2 KALIMAT!**

**FORMAT NASKAH YANG BENAR (2 KALIMAT PER SCENE):**

[JUDUL]

Selama [waktu 1], [kalimat pertama tentang aksi] [kalimat kedua tentang kondisi fisik/organ].

Selama [waktu 2], [kalimat pertama tentang tantangan baru] [kalimat kedua tentang dampak ke organ].

Selama [waktu 3], [kalimat pertama tentang konflik] [kalimat kedua tentang organ semakin tertekan].

Selama [waktu 4], [kalimat pertama tentang klimaks] [kalimat kedua tentang organ di ambang batas].

Akhirnya, pada [waktu 5], [kalimat pertama tentang kegagalan total] [kalimat kedua tentang organ hancur].

**CONTOH NASKAH (2 KALIMAT PER SCENE):**

Berapa Jam Bertarung Sampai Jantungku HANCUR?

Selama 1 jam, kamu berdiri gagah di puncak tebing dengan katana terhunus menghadap ke arah musuh yang datang. Jantungmu berdetak penuh semangat memompa darah ke seluruh tubuh yang siap bertarung.

Selama 3 jam, pedang musuh berhasil melukai lengan dan kakimu meninggalkan goresan-goresan dalam. Jantung mulai bekerja lebih keras memompa darah keluar dari pembuluh yang robek.

Selama 6 jam, hujan lebat turun membasahi medan perang yang sudah dipenuhi mayat. Jantungmu mulai kehilangan irama, kadang berdetak cepat lalu tiba-tiba melambat.

Selama 12 jam, senja mulai datang dan musuh terakhir masih berdiri di hadapanmu. Jantungmu berdetak begitu lemah, setiap detak terasa seperti pukulan palu di dada.

Akhirnya, pada jam ke-24, tubuhmu roboh di genangan air hujan bercampur darah. Jantung yang hancur berserakan di rongga dada transparan saat katana patah jatuh di sampingmu.

**SETELAH SCRIPT, BUAT 5 SCENE BREAKDOWN DENGAN FORMAT:**

For EACH scene, use this EXACT formula:

**RUMUS PROMPT: "Place the skeleton character" + [AKSI DINAMIS sesuai scene] + [KONTEKS LINGKUNGAN sesuai tema] + [DETAIL PROPERTI dari tema] + [TIPE CAHAYA sesuai waktu] + [SUDUT KAMERA dramatis] + [EFEK VISUAL epik] + "Rendered in clean cinematic 3D, highly detailed."**

Format output:
===SCRIPT===
(script lengkap dengan 2 kalimat per scene)
===SCENES===
Scene 1:
Time: [waktu dari script]
Environment: [lokasi sesuai tema]
Image prompt: [Place the skeleton character... Rendered in clean cinematic 3D, highly detailed.]
Video prompt: [Deskripsi gerakan kamera dan karakter 1-2 kalimat]`;

        const body = {
            model: GROQ_MODEL,
            messages: [{ role: "user", content: systemPrompt }],
            temperature: 0.9,
            max_tokens: 6000
        };

        const resp = await fetch(GROQ_URL, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${apiKey}`, 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
        });

        if (!resp.ok) {
            const errData = await resp.json().catch(() => ({}));
            const error = new Error(errData.error?.message || `HTTP Error ${resp.status}`);
            error.rawResponse = JSON.stringify(errData, null, 2);
            throw error;
        }

        const data = await resp.json();
        const fullContent = data.choices[0]?.message?.content || "";
        
        if (!fullContent) {
            throw new Error('Response kosong dari API');
        }

        if (!fullContent.includes("===SCRIPT===") || !fullContent.includes("===SCENES===")) {
            const error = new Error('Format response tidak sesuai. Expected ===SCRIPT=== and ===SCENES=== markers.');
            error.rawResponse = fullContent;
            throw error;
        }

        const parts = fullContent.split("===SCENES===");
        const scriptPart = parts[0].replace("===SCRIPT===", "").trim();
        const scenesPart = parts[1] || "";

        const sceneRegex = /Scene\s*\d+.*?:\s*Time:\s*(.*?)\s*Environment:\s*(.*?)\s*Image prompt:\s*(.*?)\s*Video prompt:\s*(.*?)(?=\n\s*Scene|\n*$)/gis;
        const scenes = [];
        let match;
        
        while ((match = sceneRegex.exec(scenesPart)) !== null) {
            scenes.push({
                time: match[1].trim(),
                environment: match[2].trim(),
                imagePrompt: match[3].trim(),
                videoPrompt: match[4].trim()
            });
        }

        if (scenes.length === 0) {
            const error = new Error('Tidak ada scene yang ditemukan dalam response');
            error.rawResponse = scenesPart;
            throw error;
        }

        return { script: scriptPart, scenes: scenes };
    }

    window.copyText = copyText;
    window.toggleFullPrompt = toggleFullPrompt;
</script>
</body>
</html>
