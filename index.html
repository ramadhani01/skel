<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extreme Viral Engine v2</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#0f172a;
    color:white;
}
.container{
    max-width:1000px;
    margin:auto;
    padding:20px;
}
h1{
    text-align:center;
    color:#38bdf8;
}
.card{
    background:#1e293b;
    padding:20px;
    border-radius:12px;
    margin-bottom:20px;
}
button{
    background:#38bdf8;
    color:black;
    padding:8px 14px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
    margin-top:6px;
}
button:hover{opacity:0.85}
.idea{
    background:#334155;
    padding:12px;
    border-radius:8px;
    margin-bottom:10px;
    cursor:pointer;
}
.idea:hover{background:#475569}
.scene{
    background:#0b1220;
    padding:15px;
    border-radius:10px;
    margin-bottom:20px;
    border:1px solid #334155;
}
.copyBtn{
    background:#22c55e;
    color:black;
}
pre{
    white-space:pre-wrap;
}
input{
    width:100%;
    padding:10px;
    border-radius:8px;
    border:none;
    margin-bottom:10px;
}
</style>
</head>
<body>

<div class="container">

<h1>ðŸ”¥ EXTREME VIRAL SHORTS ENGINE</h1>

<div class="card">
<label>Masukkan GROQ API Key</label>
<input type="password" id="apiKey">
<button onclick="saveKey()">Simpan Key</button>
</div>

<div class="card">
<button onclick="generateIdeas()">Generate Extreme Ideas</button>
</div>

<div class="card">
<h3>Ide Viral</h3>
<div id="ideas"></div>
</div>

<div class="card">
<h3>Narasi + Scene Prompts</h3>
<div id="result"></div>
</div>

</div>

<script>

window.onload = function(){
    const savedKey = localStorage.getItem("GROQ_API_KEY");
    if(savedKey){
        document.getElementById("apiKey").value = savedKey;
    }
}

function saveKey(){
    localStorage.setItem("GROQ_API_KEY",document.getElementById("apiKey").value);
    alert("API Key tersimpan!");
}

async function callGroq(prompt){
    const key = localStorage.getItem("GROQ_API_KEY");
    if(!key){ alert("Masukkan API Key dulu!"); return null; }

    const response = await fetch("https://api.groq.com/openai/v1/responses",{
        method:"POST",
        headers:{
            "Content-Type":"application/json",
            "Authorization":"Bearer "+key
        },
        body: JSON.stringify({
            model:"openai/gpt-oss-20b",
            input:prompt
        })
    });

    const data = await response.json();

    let text="";
    if(data.output){
        data.output.forEach(item=>{
            if(item.content){
                item.content.forEach(part=>{
                    if(part.type==="output_text"){
                        text+=part.text;
                    }
                });
            }
        });
    }

    return text;
}

async function generateIdeas(){
    document.getElementById("ideas").innerHTML="Loading...";
    document.getElementById("result").innerHTML="";

    const prompt=`
Buat 10 ide YouTube Shorts ekstrem.

Aturan:
- Tanpa angka di judul.
- Fokus lingkungan ekstrem, hewan liar, reaksi kimia, kondisi aneh.
- Harus misterius dan bikin penasaran.
- Gaya: "Apa yang terjadi jika...","Berapa lama kamu bisa...","Bagaimana jika..."
- Jangan generik.
- Format daftar saja.
`;

    const text=await callGroq(prompt);
    if(!text) return;

    const lines=text.split("\n").filter(l=>l.trim()!="");
    const ideasDiv=document.getElementById("ideas");
    ideasDiv.innerHTML="";

    lines.forEach(line=>{
        const div=document.createElement("div");
        div.className="idea";
        div.innerText=line;
        div.onclick=()=>generateFullVideo(line);
        ideasDiv.appendChild(div);
    });
}

async function generateFullVideo(idea){
    document.getElementById("result").innerHTML="Generating...";

    const prompt=`
Buat narasi 45-70 detik untuk YouTube Shorts.

Format:

[NARASI]
Judul menyatu sebagai kalimat pembuka.
Gunakan progresi waktu seperti:
Selama detik...
Selama menit...
Selama waktu...

Lalu buat SCENE mengikuti narasi (jumlah scene fleksibel, sesuai alur).

Aturan SCENE:
- Lokasi sama dari awal sampai akhir.
- Karakter sama.
- Lighting sama.
- Gaya 3D anatomi transparan edukatif.
- Detail sinematik tinggi.
- Jangan gore.

Format SCENE:

SCENE 1
[prompt image]
detail sinematik

[prompt video]
gerakan kamera, efek cahaya, animasi tubuh

Topik: ${idea}
`;

    const text=await callGroq(prompt);
    if(!text) return;

    renderScenes(text);
}

function renderScenes(text){
    const container=document.getElementById("result");
    container.innerHTML="";

    const scenes=text.split("SCENE").filter(s=>s.trim()!="");

    scenes.forEach(scene=>{
        const full="SCENE"+scene;

        const parts=full.split("[prompt video]");
        const imagePart=parts[0];
        const videoPart=parts[1] || "";

        const div=document.createElement("div");
        div.className="scene";

        div.innerHTML=`
        <pre>${imagePart}</pre>
        <button class="copyBtn" onclick="copyText(this)">Copy Image Prompt</button>
        <pre>[prompt video]${videoPart}</pre>
        <button class="copyBtn" onclick="copyText(this)">Copy Video Prompt</button>
        `;

        container.appendChild(div);
    });
}

function copyText(btn){
    const text=btn.previousElementSibling.innerText;
    navigator.clipboard.writeText(text);
    btn.innerText="Copied!";
    setTimeout(()=>btn.innerText="Copy",1500);
}

</script>

</body>
</html>
